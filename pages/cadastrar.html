<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro de Sinistro - GreenFire</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
    
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet" />
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    
    <style>
      body {
        background-color: #f0f8ff;
        font-family: 'Poppins', sans-serif;
        color: #333;
      }

      h2 {
        font-size: 2.5rem;
        font-weight: 600;
        color: #28a745;
        margin-bottom: 20px;
      }

      .form-label {
        font-weight: 500;
      }

      .form-control {
        border-radius: 10px;
        padding: 12px;
        font-size: 1.1rem;
      }

      .btn-primary {
        background-color: #28a745;
        border: none;
        padding: 10px 20px;
        font-size: 1.2rem;
        font-weight: 500;
        border-radius: 10px;
        width: 100%;
        transition: background-color 0.3s ease;
      }

      .btn-primary:hover {
        background-color: #218838;
      }

      hr {
        border-top: 1px solid #ddd;
      }

      .icon {
        font-size: 2rem;
        color: #28a745;
      }

      #map {
        margin-top: 30px;
        height: 400px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>

  <body>
    <div class="container mt-5">
      <div class="text-center">
        
      </div>

      <form id="formEndereco" class="p-5 bg-white shadow rounded">
        <!-- Nome Completo -->
        <div class="mb-3">
          <label for="nome" class="form-label">Nome Completo</label>
          <input type="text" class="form-control" id="nome" required />
        </div>

        <!-- CPF -->
        <div class="mb-3">
          <label for="cpf" class="form-label">CPF</label>
          <input type="text" class="form-control" id="cpf" required />
        </div>

        <!-- Separador -->
        <hr class="mt-4 mb-4">

        <!-- CEP -->
        <div class="mb-3">
          <label for="cep" class="form-label">CEP</label>
          <input type="text" class="form-control" id="cep" required />
        </div>

        <!-- Logradouro -->
        <div class="mb-3">
          <label for="logradouro" class="form-label">Logradouro</label>
          <input type="text" class="form-control" id="logradouro" readonly />
        </div>

        <!-- Bairro -->
        <div class="mb-3">
          <label for="bairro" class="form-label">Bairro</label>
          <input type="text" class="form-control" id="bairro" readonly />
        </div>

        <!-- Cidade -->
        <div class="mb-3">
          <label for="cidade" class="form-label">Cidade</label>
          <input type="text" class="form-control" id="cidade" readonly />
        </div>

        <!-- Estado -->
        <div class="mb-3">
          <label for="estado" class="form-label">Estado</label>
          <input type="text" class="form-control" id="estado" readonly />
        </div>

        <!-- Número -->
        <div class="mb-3">
          <label for="numero" class="form-label">Número</label>
          <input type="text" class="form-control" id="numero" required />
        </div>

        <!-- Separador -->
        <hr class="mt-4 mb-4">

        <!-- Serviços -->
        <div class="mb-3">
          <label for="servicos" class="form-label">Serviços Necessários</label>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="ambulancia" id="servicoAmbulancia" />
            <label class="form-check-label" for="servicoAmbulancia">Ambulância (SAMU)</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="bombeiros" id="servicoBombeiros" />
            <label class="form-check-label" for="servicoBombeiros">Bombeiros</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="policia" id="servicoPolicia" />
            <label class="form-check-label" for="servicoPolicia">Polícia</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="ibama" id="servicoIbama" />
            <label class="form-check-label" for="servicoIbama">IBAMA</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="defesaCivil" id="servicoDefesaCivil" />
            <label class="form-check-label" for="servicoDefesaCivil">Defesa Civil</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="outro" id="servicoOutro" />
            <label class="form-check-label" for="servicoOutro">Outros</label>
          </div>
        </div>

        <!-- Detalhes do Sinistro -->
        <div class="mb-3">
          <label for="detalhes" class="form-label">O que aconteceu?</label>
          <textarea class="form-control" id="detalhes" rows="4" placeholder="Descreva o ocorrido..." required></textarea>
        </div>

        <!-- Mapa -->
        <div class="mt-5" id="map"></div>

        <!-- Botão Enviar -->
        <button type="submit" class="mt-4 btn btn-primary">Enviar</button>
      </form>

    </div>

    <!-- Script para integração com ViaCEP -->
    <script>
      $(document).ready(function () {
        $("#cep").on("blur", function () {
          var cep = $(this).val().replace(/\D/g, "");
          if (cep != "") {
            var validacep = /^[0-9]{8}$/;
            if (validacep.test(cep)) {
              $.getJSON(
                "https://viacep.com.br/ws/" + cep + "/json/?callback=?",
                function (dados) {
                  if (!("erro" in dados)) {
                    $("#logradouro").val(dados.logradouro);
                    $("#bairro").val(dados.bairro);
                    $("#cidade").val(dados.localidade);
                    $("#estado").val(dados.uf);

                    // Exibe o mapa com base no endereço preenchido
                    var endereco = `${dados.logradouro}, ${dados.localidade}, ${dados.uf}`;
                    exibirMapa(endereco);
                  } else {
                    alert("CEP não encontrado.");
                  }
                }
              );
            } else {
              alert("Formato de CEP inválido.");
            }
          }
        });
      });

      function exibirMapa(endereco) {
        var map = L.map('map').setView([-23.55052, -46.633308], 15);// Coordenadas iniciais para o mapa (São Paulo) 

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: '© OpenStreetMap'
        }).addTo(map);

        // Usando a API Nominatim para geocodificação
        var geocoder = new L.Control.Geocoder.Nominatim();
        geocoder.geocode(endereco, function(results) {
          if (results.length > 0) {
            var latLng = results[0].center;
            map.setView(latLng, 15);
            L.marker(latLng).addTo(map).bindPopup('Endereço: ' + endereco).openPopup();
          } else {
            alert("Não foi possível localizar o endereço.");
          }
        });
      }
    </script>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
  </body>
</html>
